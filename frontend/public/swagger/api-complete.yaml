openapi: 3.0.3
info:
  title: E-Learning Platform API - Complete Documentation
  description: |
    **üéì Complete E-Learning Platform API Documentation**

    This is the unified Swagger documentation combining all API parts:
    - Part 1: Authentication & User Management
    - Part 2: Courses, Chapters & Lessons
    - Part 3: Quizzes & Progress Tracking
    - Part 4: Discussions & Comments
    - Part 5: Live Sessions & Notifications

    **üìö API Categories:**
    - üîê Auth: Login, Register, Password Reset
    - üë§ Users: Profile Management, Admin Operations
    - üìñ Courses: Course CRUD, Enrollment
    - üìù Lessons: Content Management, Videos, Resources
    - ‚ùì Quizzes: Assessment System
    - üí¨ Discussions: Forum & Comments
    - üé• Live Sessions: Video Calls & WebRTC
    - üîî Notifications: Real-time Updates
    - üìä Progress: Learning Analytics

    **üîë Authentication:**
    - JWT Bearer Token required for protected routes
    - Token expires in 24 hours
    - Refresh token mechanism available

    **üë• User Roles:**
    - **Student**: Enroll, learn, take quizzes, join discussions
    - **Teacher**: Create courses, manage content, host sessions
    - **Admin**: Full system access, user management, moderation

    **Base URL:** `http://localhost:3000/api`

  version: 1.0.0
  contact:
    name: E-Learning Platform Support
    email: support@elearning.com
  license:
    name: MIT

servers:
  - url: http://localhost:3000/api
    description: Local Development Server
  - url: https://api.elearning.com/api
    description: Production Server

tags:
  - name: üîê Authentication
    description: User authentication operations
  - name: üë§ User Management
    description: User profile and account management
  - name: üë• Admin - Users
    description: Admin user management operations
  - name: üìö Courses
    description: Course management and operations
  - name: üìñ Chapters
    description: Chapter organization within courses
  - name: üìù Lessons
    description: Lesson content and media
  - name: ‚ùì Quizzes
    description: Quiz creation and management
  - name: üìã Questions
    description: Quiz question management
  - name: ‚úÖ Quiz Attempts
    description: Student quiz taking
  - name: üí¨ Discussions
    description: Course discussion forums
  - name: üí≠ Comments
    description: Comment operations
  - name: üé• Live Sessions
    description: Live video sessions
  - name: üîî Notifications
    description: User notifications
  - name: üìä Progress
    description: Learning progress tracking
  - name: üìà Analytics
    description: Course and student analytics

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from login/register endpoint.

        **Usage:**
        ```
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        ```

  parameters:
    PageParam:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        minimum: 1
        default: 1

    LimitParam:
      name: limit
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10

    CourseIdParam:
      name: courseId
      in: path
      required: true
      description: Course ID
      schema:
        type: string
        example: "507f1f77bcf86cd799439011"

  schemas:
    # ============ USER SCHEMAS ============
    User:
      type: object
      properties:
        _id:
          type: string
        fullName:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [student, teacher, admin]
        avatar:
          type: string
          nullable: true
        isVerified:
          type: boolean
          description: "Email verification status (renamed from isEmailVerified)"
        isBanned:
          type: boolean
        profileCompleted:
          type: boolean
          description: "Teacher profile completion status (required for teachers)"
        profileApprovalStatus:
          type: string
          enum: [pending, approved, rejected]
          description: "Admin approval status for teacher profiles"
        phone:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    UserRegistration:
      type: object
      required:
        - fullName
        - email
        - password
        - role
        - dateOfBirth
      properties:
        fullName:
          type: string
          minLength: 2
          example: "Nguy·ªÖn VƒÉn A"
        email:
          type: string
          format: email
          example: "student@example.com"
        password:
          type: string
          minLength: 6
          example: "password123"
        role:
          type: string
          enum: [student, teacher]
          description: "Select via radio buttons (student or teacher only)"
          example: "student"
        dateOfBirth:
          type: string
          format: date
          description: "Date of birth (YYYY-MM-DD format)"
          example: "2000-01-15"

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        token:
          type: string
        user:
          $ref: "#/components/schemas/User"

    # ============ COURSE SCHEMAS ============
    Course:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        description:
          type: string
        thumbnail:
          type: string
        instructor:
          type: object
        category:
          type: string
        level:
          type: string
          enum: [beginner, intermediate, advanced]
        price:
          type: number
        isPublished:
          type: boolean
        enrollmentCount:
          type: integer
        averageRating:
          type: number

    # ============ DISCUSSION SCHEMAS ============
    Discussion:
      type: object
      properties:
        _id:
          type: string
        courseId:
          type: string
        author:
          type: object
        title:
          type: string
        content:
          type: string
        isPinned:
          type: boolean
        likeCount:
          type: integer
        commentCount:
          type: integer
        createdAt:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        _id:
          type: string
        discussionId:
          type: string
        author:
          type: object
        content:
          type: string
        parentId:
          type: string
          nullable: true
        likeCount:
          type: integer
        createdAt:
          type: string
          format: date-time

    # ============ SESSION SCHEMAS ============
    LiveSession:
      type: object
      properties:
        _id:
          type: string
        courseId:
          type: string
        hostId:
          type: string
        title:
          type: string
        description:
          type: string
        scheduledAt:
          type: string
          format: date-time
        duration:
          type: integer
          description: "Duration in minutes"
        status:
          type: string
          enum: [scheduled, live, ended, cancelled]
        participants:
          type: array
          items:
            type: string
        recordingUrl:
          type: string
          nullable: true

    # ============ NOTIFICATION SCHEMAS ============
    Notification:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        type:
          type: string
          enum: [course, quiz, discussion, session, system]
        title:
          type: string
        message:
          type: string
        link:
          type: string
          nullable: true
        isRead:
          type: boolean
        createdAt:
          type: string
          format: date-time

    # ============ COMMON SCHEMAS ============
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
        errors:
          type: array
          items:
            type: string

    Success:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

paths:
  # ==================== AUTHENTICATION ====================
  /auth/register:
    post:
      tags:
        - üîê Authentication
      summary: Register new user
      description: |
        Register new user account with mandatory email verification.

        **UI Changes:**
        - Role selection via radio buttons (student/teacher only)
        - No dropdown, just two radio options
        - Admin accounts created through different means

        **Registration Flow:**
        ```
        Student: Register ‚Üí Email verification required ‚Üí Login ‚Üí Dashboard
        Teacher: Register ‚Üí Email verification ‚Üí Login ‚Üí Complete profile ‚Üí Approval pending ‚Üí Dashboard
        ```

        **After Registration:**
        - Verification email sent automatically
        - User redirected to /email-verification-required page
        - Cannot login until email is verified
        - isVerified = false by default
        - profileCompleted = false for teachers
        - profileApprovalStatus = "pending" for teachers
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegistration"
            example:
              fullName: "Nguy·ªÖn VƒÉn A"
              email: "student@example.com"
              password: "password123"
              role: "student"
              dateOfBirth: "2000-01-15"
      responses:
        "201":
          description: Registration successful, verification email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Registration successful. Please check your email to verify your account."
                  user:
                    $ref: "#/components/schemas/User"
              examples:
                studentRegistration:
                  value:
                    success: true
                    message: "Registration successful. Please check your email to verify your account."
                    user:
                      _id: "507f1f77bcf86cd799439011"
                      fullName: "Nguy·ªÖn VƒÉn A"
                      email: "student@example.com"
                      role: "student"
                      isVerified: false
                      profileCompleted: true
                      createdAt: "2024-01-15T10:30:00Z"
                teacherRegistration:
                  value:
                    success: true
                    message: "Registration successful. Please check your email to verify your account."
                    user:
                      _id: "507f1f77bcf86cd799439012"
                      fullName: "Tr·∫ßn Th·ªã B"
                      email: "teacher@example.com"
                      role: "teacher"
                      isVerified: false
                      profileCompleted: false
                      profileApprovalStatus: "pending"
                      createdAt: "2024-01-15T10:35:00Z"
        "400":
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                emailExists:
                  value:
                    success: false
                    message: "Email already registered"
                invalidData:
                  value:
                    success: false
                    message: "All fields are required"

  /auth/login:
    post:
      tags:
        - üîê Authentication
      summary: User login
      description: |
        Authenticate user and return JWT tokens with comprehensive user data.

        **Login Flow Decision Tree:**
        ```
        Login Attempt
        ‚îÇ
        ‚îú‚îÄ Email not verified (isVerified = false)?
        ‚îÇ  ‚îî‚îÄ ‚Üí Return 403 with requiresVerification flag
        ‚îÇ     ‚Üí Frontend redirects to /email-verification-required
        ‚îÇ
        ‚îú‚îÄ Student (role = "student")?
        ‚îÇ  ‚îî‚îÄ ‚Üí Return 200 with tokens
        ‚îÇ     ‚Üí Frontend redirects to /student/dashboard
        ‚îÇ
        ‚îî‚îÄ Teacher (role = "teacher")?
           ‚îÇ
           ‚îú‚îÄ Profile not completed (profileCompleted = false)?
           ‚îÇ  ‚îî‚îÄ ‚Üí Return 200 with tokens
           ‚îÇ     ‚Üí Frontend redirects to /teacher/complete-profile
           ‚îÇ
           ‚îî‚îÄ Profile completed?
              ‚îÇ
              ‚îú‚îÄ Approval pending (profileApprovalStatus = "pending")?
              ‚îÇ  ‚îî‚îÄ ‚Üí Return 200 with tokens
              ‚îÇ     ‚Üí Frontend redirects to /teacher/approval-pending
              ‚îÇ
              ‚îú‚îÄ Approved (profileApprovalStatus = "approved")?
              ‚îÇ  ‚îî‚îÄ ‚Üí Return 200 with tokens
              ‚îÇ     ‚Üí Frontend redirects to /teacher/dashboard
              ‚îÇ
              ‚îî‚îÄ Rejected (profileApprovalStatus = "rejected")?
                 ‚îî‚îÄ ‚Üí Return 200 with tokens
                    ‚Üí Frontend shows rejection notice
        ```

        **Response Structure:**
        - Contains full user object with profile data
        - Includes profile relationship (userProfile)
        - Frontend uses these fields for redirect logic
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "student@example.com"
                password:
                  type: string
                  minLength: 6
                  example: "password123"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  accessToken:
                    type: string
                    description: "JWT access token (expires in 24h)"
                  refreshToken:
                    type: string
                    description: "JWT refresh token (expires in 7d)"
                  user:
                    type: object
                    properties:
                      _id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      role:
                        type: string
                      avatar:
                        type: string
                      isVerified:
                        type: boolean
                      profileCompleted:
                        type: boolean
                      profileApprovalStatus:
                        type: string
                      userProfile:
                        type: object
                        description: "Extended profile data from userProfile collection"
              examples:
                studentLogin:
                  value:
                    success: true
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    user:
                      _id: "507f1f77bcf86cd799439011"
                      fullName: "Nguy·ªÖn VƒÉn A"
                      email: "student@example.com"
                      role: "student"
                      avatar: "https://cloudinary.com/avatar.jpg"
                      isVerified: true
                      profileCompleted: true
                      userProfile:
                        phone: "0987654321"
                        address: "H√† N·ªôi"
                        bio: "Sinh vi√™n nƒÉm 3"
                teacherNeedProfile:
                  value:
                    success: true
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    user:
                      _id: "507f1f77bcf86cd799439012"
                      fullName: "Tr·∫ßn Th·ªã B"
                      email: "teacher@example.com"
                      role: "teacher"
                      isVerified: true
                      profileCompleted: false
                      profileApprovalStatus: "pending"
                teacherPendingApproval:
                  value:
                    success: true
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    user:
                      _id: "507f1f77bcf86cd799439013"
                      fullName: "Ph·∫°m VƒÉn C"
                      email: "teacher2@example.com"
                      role: "teacher"
                      isVerified: true
                      profileCompleted: true
                      profileApprovalStatus: "pending"
                      userProfile:
                        phone: "0912345678"
                        address: "TP.HCM"
                        bio: "Gi·∫£ng vi√™n v·ªõi 5 nƒÉm kinh nghi·ªám"
                        expertise: "Web Development, React"
                        qualifications: "Th·∫°c sƒ© CNTT"
                        cvUrl: "https://cloudinary.com/cvs/cv123.pdf"
                teacherApproved:
                  value:
                    success: true
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    user:
                      _id: "507f1f77bcf86cd799439014"
                      fullName: "L√™ Th·ªã D"
                      email: "teacher3@example.com"
                      role: "teacher"
                      isVerified: true
                      profileCompleted: true
                      profileApprovalStatus: "approved"
                      userProfile:
                        phone: "0923456789"
                        address: "ƒê√† N·∫µng"
                        bio: "Senior Developer"
                        expertise: "Java, Spring Boot"
                        qualifications: "PhD Computer Science"
                        cvUrl: "https://cloudinary.com/cvs/cv456.pdf"
        "401":
          description: Invalid email or password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                success: false
                message: "Invalid email or password"
        "403":
          description: Email not verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Please verify your email before logging in."
                  requiresVerification:
                    type: boolean
                    example: true
                    description: "Flag indicating frontend should redirect to verification page"

  /auth/logout:
    post:
      tags:
        - üîê Authentication
      summary: User logout
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Logout successful

  /auth/forgot-password:
    post:
      tags:
        - üîê Authentication
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  example: "user@example.com"
      responses:
        "200":
          description: Reset email sent

  /auth/reset-password/{token}:
    put:
      tags:
        - üîê Authentication
      summary: Reset password with token
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: "NewPassword123"
      responses:
        "200":
          description: Password reset successful

  /auth/verify-email:
    post:
      tags:
        - üîê Authentication
      summary: Verify email address
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Email verification token
      responses:
        "200":
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "400":
          description: Invalid or expired token
        "500":
          description: Server error

  /auth/resend-verification:
    post:
      tags:
        - üîê Authentication
      summary: Resend email verification
      description: Resend verification email to authenticated user
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Verification email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "400":
          description: Email already verified
        "404":
          description: User not found
        "500":
          description: Server error

  /auth/refresh-token:
    post:
      tags:
        - üîê Authentication
      summary: Refresh access token
      description: |
        Generate new access token using refresh token.

        **Token Lifecycle:**
        - Access tokens expire in 24 hours
        - Refresh tokens expire in 7 days
        - Use this endpoint when access token expires
        - Returns new access token (refresh token stays the same)
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: "Refresh token obtained from login"
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: New access token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  accessToken:
                    type: string
                    description: "New access token (expires in 24h)"
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "401":
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                success: false
                message: "Invalid or expired refresh token"

  # ==================== USER MANAGEMENT ====================
  /users/profile:
    get:
      tags:
        - üë§ User Management
      summary: Get current user profile
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    $ref: "#/components/schemas/User"

    put:
      tags:
        - üë§ User Management
      summary: Update user profile
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                phone:
                  type: string
                address:
                  type: string
      responses:
        "200":
          description: Profile updated

  /users/avatar:
    post:
      tags:
        - üë§ User Management
      summary: Upload avatar
      security:
        - BearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        "200":
          description: Avatar uploaded

  /users/complete-teacher-profile:
    post:
      tags:
        - üë§ User Management
      summary: Complete teacher profile (Teachers only)
      description: |
        Submit complete teacher profile information with CV upload.
        This endpoint is REQUIRED for teachers after email verification and before dashboard access.

        **Prerequisites:**
        - Must be logged in as teacher
        - Email must be verified (isVerified = true)
        - Profile not yet completed (profileCompleted = false)

        **Required Fields:**
        - Phone number
        - Address
        - Bio (personal introduction)
        - Expertise (areas of specialization)
        - Qualifications (education & certifications)
        - CV file (PDF only, max 5MB)

        **Teacher Workflow:**
        1. Register ‚Üí Email verification
        2. Login ‚Üí Redirect to `/teacher/complete-profile`
        3. Fill form and upload CV
        4. Submit ‚Üí CV uploaded to Cloudinary
        5. Backend sets `profileCompleted = true` and `profileApprovalStatus = "pending"`
        6. Redirect to `/teacher/approval-pending`
        7. Wait 24-48 hours for admin review
        8. Admin approves/rejects ‚Üí Email notification
        9. If approved, access dashboard

        **CV Upload:**
        - File uploaded to Cloudinary folder: "cvs"
        - Returns secure_url and public_id
        - Local file deleted after successful upload
      operationId: completeTeacherProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - phone
                - address
                - bio
                - expertise
                - qualifications
                - cv
              properties:
                phone:
                  type: string
                  example: "0987654321"
                  description: "Teacher's phone number"
                address:
                  type: string
                  example: "123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP.HCM"
                  description: "Full address"
                bio:
                  type: string
                  example: "T√¥i l√† gi·∫£ng vi√™n v·ªõi 10 nƒÉm kinh nghi·ªám..."
                  description: "Personal introduction and teaching philosophy"
                expertise:
                  type: string
                  example: "L·∫≠p tr√¨nh Web (React, Node.js), Machine Learning, Data Science"
                  description: "Areas of expertise and specialization"
                qualifications:
                  type: string
                  example: "Th·∫°c sƒ© Khoa h·ªçc M√°y t√≠nh - ƒêH B√°ch Khoa, Ch·ª©ng ch·ªâ AWS Solutions Architect"
                  description: "Educational background, degrees, and certifications"
                cv:
                  type: string
                  format: binary
                  description: "CV file in PDF format (max 5MB)"
      responses:
        "200":
          description: Profile submitted successfully, awaiting admin approval
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Profile submitted successfully. Please wait for admin approval (at least 48 hours)."
                  data:
                    type: object
                    properties:
                      profileCompleted:
                        type: boolean
                        example: true
                      profileApprovalStatus:
                        type: string
                        example: "pending"
        "400":
          description: Validation error or profile already completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                missingFields:
                  value:
                    success: false
                    message: "All fields are required."
                alreadyCompleted:
                  value:
                    success: false
                    message: "Profile has already been completed."
                invalidFile:
                  value:
                    success: false
                    message: "CV file is required."
        "403":
          description: Not authorized or email not verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notTeacher:
                  value:
                    success: false
                    message: "Only teachers can complete this profile."
                notVerified:
                  value:
                    success: false
                    message: "Please verify your email first."
        "500":
          description: Server error (e.g., CV upload failed)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                success: false
                message: "Failed to upload CV."

  # ==================== ADMIN USER MANAGEMENT ====================
  /users/list:
    get:
      tags:
        - üë• Admin - Users
      summary: Get all users (Admin)
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: role
          in: query
          schema:
            type: string
            enum: [student, teacher, admin]
        - name: search
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Users retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  users:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

  /users/{id}/role:
    put:
      tags:
        - üë• Admin - Users
      summary: Update user role (Admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [student, teacher, admin]
      responses:
        "200":
          description: Role updated

  /users/{id}/ban:
    put:
      tags:
        - üë• Admin - Users
      summary: Ban/unban user (Admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - isBanned
              properties:
                isBanned:
                  type: boolean
      responses:
        "200":
          description: Ban status updated

  # ==================== COURSES ====================
  /courses:
    get:
      tags:
        - üìö Courses
      summary: Get all courses (Public)
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: category
          in: query
          schema:
            type: string
        - name: level
          in: query
          schema:
            type: string
            enum: [beginner, intermediate, advanced]
        - name: search
          in: query
          schema:
            type: string
        - name: sort
          in: query
          schema:
            type: string
            enum: [newest, popular, rating, price-asc, price-desc]
      responses:
        "200":
          description: Courses retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Course"
                  metadata:
                    type: object
                    properties:
                      total:
                        type: integer
                      page:
                        type: integer
                      limit:
                        type: integer
                      totalPages:
                        type: integer

    post:
      tags:
        - üìö Courses
      summary: Create course (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
                - category
                - level
              properties:
                title:
                  type: string
                description:
                  type: string
                category:
                  type: string
                level:
                  type: string
                price:
                  type: number
      responses:
        "201":
          description: Course created

  /courses/{id}:
    get:
      tags:
        - üìö Courses
      summary: Get course detail
      parameters:
        - $ref: "#/components/parameters/CourseIdParam"
      responses:
        "200":
          description: Course retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  course:
                    $ref: "#/components/schemas/Course"

    put:
      tags:
        - üìö Courses
      summary: Update course (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                price:
                  type: number
      responses:
        "200":
          description: Course updated

    delete:
      tags:
        - üìö Courses
      summary: Delete course (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Course deleted

  /courses/{id}/enroll:
    post:
      tags:
        - üìö Courses
      summary: Enroll in course (Student)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Enrolled successfully

  /courses/{id}/publish:
    put:
      tags:
        - üìö Courses
      summary: Publish/unpublish course (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Publish status toggled

  /courses/my-courses:
    get:
      tags:
        - üìö Courses
      summary: Get my courses (Teacher)
      security:
        - BearerAuth: []
      responses:
        "200":
          description: My courses retrieved

  /courses/enrolled:
    get:
      tags:
        - üìö Courses
      summary: Get enrolled courses (Student)
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Enrolled courses retrieved

  # ==================== CHAPTERS ====================
  /chapters:
    post:
      tags:
        - üìñ Chapters
      summary: Create chapter (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - courseId
                - title
              properties:
                courseId:
                  type: string
                  description: Course ID
                title:
                  type: string
                  description: Chapter title
                order:
                  type: integer
                  description: Display order
      responses:
        "201":
          description: Chapter created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  chapter:
                    type: object
                    properties:
                      _id:
                        type: string
                      courseId:
                        type: string
                      title:
                        type: string
                      order:
                        type: integer
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Teacher only

  /chapters/{id}:
    put:
      tags:
        - üìñ Chapters
      summary: Update chapter (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: New chapter title
      responses:
        "200":
          description: Chapter updated
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    delete:
      tags:
        - üìñ Chapters
      summary: Delete chapter (Teacher)
      description: Deletes chapter and all associated lessons and media
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Chapter deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /chapters/reorder:
    put:
      tags:
        - üìñ Chapters
      summary: Reorder chapters (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - courseId
                - chapterIds
              properties:
                courseId:
                  type: string
                  description: Course ID
                chapterIds:
                  type: array
                  items:
                    type: string
                  description: Array of chapter IDs in new order
      responses:
        "200":
          description: Chapters reordered
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  # ==================== LESSONS ====================
  /lessons:
    post:
      tags:
        - üìù Lessons
      summary: Create lesson (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - chapterId
                - title
                - type
              properties:
                chapterId:
                  type: string
                title:
                  type: string
                content:
                  type: string
                type:
                  type: string
                  enum: [video, text, quiz]
                duration:
                  type: integer
                  description: Duration in seconds
                order:
                  type: integer
      responses:
        "201":
          description: Lesson created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  lesson:
                    type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /lessons/{id}:
    get:
      tags:
        - üìù Lessons
      summary: Get lesson detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Lesson retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  lesson:
                    type: object
                    properties:
                      _id:
                        type: string
                      title:
                        type: string
                      content:
                        type: string
                      type:
                        type: string
                      videoUrl:
                        type: string
                      duration:
                        type: integer
                      resources:
                        type: array
                        items:
                          type: object
        "404":
          description: Lesson not found

    put:
      tags:
        - üìù Lessons
      summary: Update lesson (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                duration:
                  type: integer
      responses:
        "200":
          description: Lesson updated
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    delete:
      tags:
        - üìù Lessons
      summary: Delete lesson (Teacher)
      description: Deletes lesson and all associated media
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Lesson deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /lessons/{id}/video:
    post:
      tags:
        - üìù Lessons
      summary: Upload lesson video (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - video
              properties:
                video:
                  type: string
                  format: binary
                  description: Video file
      responses:
        "200":
          description: Video uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  videoUrl:
                    type: string
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /lessons/{id}/resource:
    post:
      tags:
        - üìù Lessons
      summary: Upload lesson resources (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Resource files (PDF, documents, etc.)
      responses:
        "200":
          description: Resources uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  resources:
                    type: array
                    items:
                      type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /lessons/{id}/resource/{resId}:
    delete:
      tags:
        - üìù Lessons
      summary: Delete lesson resource (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Lesson ID
        - name: resId
          in: path
          required: true
          schema:
            type: string
          description: Resource ID
      responses:
        "200":
          description: Resource deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  # ==================== QUIZZES ====================
  /quizzes:
    post:
      tags:
        - ‚ùì Quizzes
      summary: Create quiz (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - courseId
                - title
                - passingScore
              properties:
                courseId:
                  type: string
                chapterId:
                  type: string
                  nullable: true
                title:
                  type: string
                description:
                  type: string
                passingScore:
                  type: number
                  description: Minimum score to pass (0-100)
                timeLimit:
                  type: integer
                  description: Time limit in minutes
                maxAttempts:
                  type: integer
                  description: Maximum attempts allowed
                questions:
                  type: array
                  items:
                    type: object
                    required:
                      - questionText
                      - questionType
                      - options
                      - correctAnswer
                    properties:
                      questionText:
                        type: string
                      questionType:
                        type: string
                        enum: [multiple-choice, true-false, short-answer]
                      options:
                        type: array
                        items:
                          type: string
                      correctAnswer:
                        oneOf:
                          - type: string
                          - type: array
                            items:
                              type: string
                      points:
                        type: number
      responses:
        "201":
          description: Quiz created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  quiz:
                    type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /quizzes/{id}:
    get:
      tags:
        - ‚ùì Quizzes
      summary: Get quiz detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Quiz retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  quiz:
                    type: object
                    properties:
                      _id:
                        type: string
                      title:
                        type: string
                      description:
                        type: string
                      passingScore:
                        type: number
                      timeLimit:
                        type: integer
                      maxAttempts:
                        type: integer
                      questions:
                        type: array
                        items:
                          type: object
        "404":
          description: Quiz not found

    put:
      tags:
        - ‚ùì Quizzes
      summary: Update quiz (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                passingScore:
                  type: number
                timeLimit:
                  type: integer
                maxAttempts:
                  type: integer
      responses:
        "200":
          description: Quiz updated
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    delete:
      tags:
        - ‚ùì Quizzes
      summary: Delete quiz (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Quiz deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /quizzes/{id}/start:
    post:
      tags:
        - ‚úÖ Quiz Attempts
      summary: Start quiz attempt (Student)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "201":
          description: Quiz attempt started
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  attempt:
                    type: object
                    properties:
                      _id:
                        type: string
                      quizId:
                        type: string
                      startedAt:
                        type: string
                        format: date-time
                      expiresAt:
                        type: string
                        format: date-time
        "400":
          description: Max attempts reached or already in progress
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /quizzes/{id}/submit:
    post:
      tags:
        - ‚úÖ Quiz Attempts
      summary: Submit quiz attempt (Student)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - answers
              properties:
                answers:
                  type: array
                  items:
                    type: object
                    required:
                      - questionId
                      - answer
                    properties:
                      questionId:
                        type: string
                      answer:
                        oneOf:
                          - type: string
                          - type: array
                            items:
                              type: string
      responses:
        "200":
          description: Quiz submitted and graded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  result:
                    type: object
                    properties:
                      score:
                        type: number
                      totalScore:
                        type: number
                      percentage:
                        type: number
                      passed:
                        type: boolean
                      correctAnswers:
                        type: integer
                      totalQuestions:
                        type: integer
        "400":
          description: Invalid submission
        "401":
          description: Unauthorized

  /quizzes/{id}/attempts:
    get:
      tags:
        - ‚úÖ Quiz Attempts
      summary: Get quiz attempts (Student)
      description: Get all attempts for a quiz by the current student
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Attempts retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  attempts:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        score:
                          type: number
                        percentage:
                          type: number
                        passed:
                          type: boolean
                        startedAt:
                          type: string
                          format: date-time
                        completedAt:
                          type: string
                          format: date-time
        "401":
          description: Unauthorized

  /quizzes/{id}/results/{attemptId}:
    get:
      tags:
        - ‚úÖ Quiz Attempts
      summary: Get quiz result detail
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Quiz ID
        - name: attemptId
          in: path
          required: true
          schema:
            type: string
          description: Attempt ID
      responses:
        "200":
          description: Result retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                      score:
                        type: number
                      percentage:
                        type: number
                      passed:
                        type: boolean
                      answers:
                        type: array
                        items:
                          type: object
        "401":
          description: Unauthorized
        "404":
          description: Result not found

  # ==================== QUESTIONS ====================
  /questions/quiz/{quizId}:
    post:
      tags:
        - üìã Questions
      summary: Create question for quiz (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: quizId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - questionText
                - questionType
                - options
                - correctAnswer
              properties:
                questionText:
                  type: string
                questionType:
                  type: string
                  enum: [multiple-choice, true-false, short-answer]
                options:
                  type: array
                  items:
                    type: string
                correctAnswer:
                  oneOf:
                    - type: string
                    - type: array
                      items:
                        type: string
                points:
                  type: number
                  default: 1
      responses:
        "201":
          description: Question created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  question:
                    type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /questions/{id}:
    put:
      tags:
        - üìã Questions
      summary: Update question (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                questionText:
                  type: string
                questionType:
                  type: string
                options:
                  type: array
                  items:
                    type: string
                correctAnswer:
                  oneOf:
                    - type: string
                    - type: array
                      items:
                        type: string
                points:
                  type: number
      responses:
        "200":
          description: Question updated
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    delete:
      tags:
        - üìã Questions
      summary: Delete question (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Question deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  # ==================== PROGRESS ====================
  /progress/lesson/{lessonId}:
    put:
      tags:
        - üìä Progress
      summary: Update lesson progress (Student)
      description: Update watched duration for a lesson
      security:
        - BearerAuth: []
      parameters:
        - name: lessonId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - watchedDuration
              properties:
                watchedDuration:
                  type: integer
                  description: Duration watched in seconds
      responses:
        "200":
          description: Progress updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  progress:
                    type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /progress/complete/{lessonId}:
    post:
      tags:
        - üìä Progress
      summary: Mark lesson as completed (Student)
      security:
        - BearerAuth: []
      parameters:
        - name: lessonId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Lesson marked as completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  progress:
                    type: object
                    properties:
                      lessonId:
                        type: string
                      isCompleted:
                        type: boolean
                      completedAt:
                        type: string
                        format: date-time
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /progress/course/{courseId}:
    get:
      tags:
        - üìä Progress
      summary: Get course progress (Student)
      description: Get course progress for current student
      security:
        - BearerAuth: []
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Course progress retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  progress:
                    type: object
                    properties:
                      courseId:
                        type: string
                      completedLessons:
                        type: integer
                      totalLessons:
                        type: integer
                      percentage:
                        type: number
                      lessons:
                        type: array
                        items:
                          type: object
                          properties:
                            lessonId:
                              type: string
                            isCompleted:
                              type: boolean
                            watchedDuration:
                              type: integer
        "401":
          description: Unauthorized

  # ==================== ANALYTICS ====================
  /analytics/course/{courseId}:
    get:
      tags:
        - üìà Analytics
      summary: Get course analytics (Teacher/Admin)
      description: Get analytics data for a course with trends and growth
      security:
        - BearerAuth: []
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Course analytics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  analytics:
                    type: object
                    properties:
                      totalStudents:
                        type: integer
                      completionRate:
                        type: number
                      averageScore:
                        type: number
                      totalRevenue:
                        type: number
                      engagementRate:
                        type: number
                      trends:
                        type: object
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /analytics/student/{userId}:
    get:
      tags:
        - üìà Analytics
      summary: Get student analytics
      description: Get student analytics and learning statistics
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Student analytics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  analytics:
                    type: object
                    properties:
                      enrolledCourses:
                        type: integer
                      completedCourses:
                        type: integer
                      totalLearningTime:
                        type: integer
                      averageScore:
                        type: number
                      certificates:
                        type: integer
        "401":
          description: Unauthorized

  /analytics/dashboard:
    get:
      tags:
        - üìà Analytics
      summary: Get dashboard analytics (Teacher/Admin)
      description: Get dashboard analytics summary
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Dashboard analytics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  analytics:
                    type: object
                    properties:
                      totalCourses:
                        type: integer
                      totalStudents:
                        type: integer
                      totalRevenue:
                        type: number
                      monthlyGrowth:
                        type: number
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /analytics/export:
    get:
      tags:
        - üìà Analytics
      summary: Export course analytics to CSV (Teacher/Admin)
      security:
        - BearerAuth: []
      parameters:
        - name: courseId
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: CSV file downloaded
          content:
            text/csv:
              schema:
                type: string
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /analytics/student-report/{userId}:
    get:
      tags:
        - üìà Analytics
      summary: Generate comprehensive student report
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Student report generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  report:
                    type: object
        "401":
          description: Unauthorized

  /analytics/collect:
    post:
      tags:
        - üìà Analytics
      summary: Manually trigger analytics collection (Admin)
      description: Manually trigger analytics collection for testing or manual runs
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Analytics collection triggered
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin only

  # ==================== DISCUSSIONS ====================
  /discussions:
    post:
      tags:
        - üí¨ Discussions
      summary: Create discussion
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - courseId
                - title
                - content
              properties:
                courseId:
                  type: string
                title:
                  type: string
                content:
                  type: string
      responses:
        "201":
          description: Discussion created

  /discussions/course/{courseId}:
    get:
      tags:
        - üí¨ Discussions
      summary: Get course discussions
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
      responses:
        "200":
          description: Discussions retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  discussions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Discussion"

  /discussions/{id}:
    get:
      tags:
        - üí¨ Discussions
      summary: Get discussion detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Discussion retrieved

    put:
      tags:
        - üí¨ Discussions
      summary: Update discussion
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
      responses:
        "200":
          description: Discussion updated

    delete:
      tags:
        - üí¨ Discussions
      summary: Delete discussion
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Discussion deleted

  /discussions/{id}/like:
    put:
      tags:
        - üí¨ Discussions
      summary: Like/unlike discussion
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Like toggled

  /discussions/{id}/comment:
    post:
      tags:
        - üí≠ Comments
      summary: Comment on discussion
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                parentId:
                  type: string
                  nullable: true
      responses:
        "201":
          description: Comment created

  /comments/{id}:
    put:
      tags:
        - üí≠ Comments
      summary: Update comment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
      responses:
        "200":
          description: Comment updated

    delete:
      tags:
        - üí≠ Comments
      summary: Delete comment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Comment deleted

  /comments/{id}/like:
    put:
      tags:
        - üí≠ Comments
      summary: Like/unlike comment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Like toggled

  # ==================== LIVE SESSIONS ====================
  /sessions:
    post:
      tags:
        - üé• Live Sessions
      summary: Create live session (Teacher)
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - courseId
                - title
                - scheduledAt
                - duration
              properties:
                courseId:
                  type: string
                title:
                  type: string
                description:
                  type: string
                scheduledAt:
                  type: string
                  format: date-time
                duration:
                  type: integer
      responses:
        "201":
          description: Session created

  /sessions/my-sessions:
    get:
      tags:
        - üé• Live Sessions
      summary: Get my sessions (Teacher)
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Sessions retrieved

  /sessions/{id}:
    get:
      tags:
        - üé• Live Sessions
      summary: Get session detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session retrieved

    put:
      tags:
        - üé• Live Sessions
      summary: Update session (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                scheduledAt:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Session updated

    delete:
      tags:
        - üé• Live Sessions
      summary: Delete session (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session deleted

  /sessions/{id}/start:
    put:
      tags:
        - üé• Live Sessions
      summary: Start session (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session started

  /sessions/{id}/end:
    put:
      tags:
        - üé• Live Sessions
      summary: End session (Teacher)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session ended

  /sessions/{id}/join:
    post:
      tags:
        - üé• Live Sessions
      summary: Join session
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Joined successfully

  # ==================== NOTIFICATIONS ====================
  /notifications:
    get:
      tags:
        - üîî Notifications
      summary: Get notifications
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - name: type
          in: query
          schema:
            type: string
            enum: [course, quiz, discussion, session, system]
        - name: isRead
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: Notifications retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  notifications:
                    type: array
                    items:
                      $ref: "#/components/schemas/Notification"

  /notifications/unread-count:
    get:
      tags:
        - üîî Notifications
      summary: Get unread count
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Count retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  count:
                    type: integer

  /notifications/{id}/read:
    put:
      tags:
        - üîî Notifications
      summary: Mark as read
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Marked as read

  /notifications/read-all:
    put:
      tags:
        - üîî Notifications
      summary: Mark all as read
      security:
        - BearerAuth: []
      responses:
        "200":
          description: All marked as read

  /notifications/{id}:
    delete:
      tags:
        - üîî Notifications
      summary: Delete notification
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Notification deleted
